; PlatformIO Project Configuration File for MoRa-LC
; 
; Multi-Environment Setup f√ºr alle Firmware-Varianten
;
; Build: pio run -e <environment>
; Upload: pio run -e <environment> -t upload
; Monitor: pio device monitor

[platformio]
default_envs = ultralight_v2
lib_dir = lib
src_dir = src

; ============================================================
; SHARED CONFIGURATION
; ============================================================

[env]
platform = espressif32
framework = arduino
monitor_speed = 115200
upload_speed = 460800
build_flags = 
    -DCORE_DEBUG_LEVEL=0

; ============================================================
; ULTRALIGHT: CheapYellow Display (TFT_eSPI - Legacy)
; ============================================================

[env:ultralight]
board = esp32dev
build_src_filter = 
    +<ultralight/>
lib_deps = 
    bodmer/TFT_eSPI
    h2zero/NimBLE-Arduino
    bblanchon/ArduinoJson
    paulstoffregen/XPT2046_Touchscreen
    ; https://github.com/TAMCTec/gt911-arduino.git
build_flags = 
    ${env.build_flags}
    -DULTRALIGHT_VARIANT
    -DUSER_SETUP_LOADED=1
    -DST7789_DRIVER=1
    -DTFT_WIDTH=240
    -DTFT_HEIGHT=320
    -DTFT_MOSI=13
    -DTFT_SCLK=14
    -DTFT_CS=15
    -DTFT_DC=2
    -DTFT_RST=-1
    -DTFT_BL=21
    -DUSE_XPT2046_TOUCH=1
    -DXPT2046_IRQ=36
    -DXPT2046_MOSI=32
    -DXPT2046_MISO=39
    -DXPT2046_CLK=25
    -DXPT2046_CS=33
    ; GT911 disabled - using resistive touch
    ; -DTOUCH_SDA=33
    ; -DTOUCH_SCL=32
    ; -DTOUCH_INT=21
    ; -DTOUCH_RST=25
    ; -DUSE_GT911_TOUCH=1
    -DLOAD_GLCD=1
    -DLOAD_FONT2=1
    -DLOAD_FONT4=1
    -DLOAD_FONT6=1
    -DLOAD_FONT7=1
    -DLOAD_FONT8=1
    -DLOAD_GFXFF=1
    -DSMOOTH_FONT=1
    -DSPI_FREQUENCY=40000000
    -DSPI_READ_FREQUENCY=20000000

; ============================================================
; ULTRALIGHT V2: CheapYellow Display (LovyanGFX - Rewrite)
; ============================================================

[env:ultralight_v2]
board = esp32dev
build_src_filter = 
    +<ultralight_v2/>
    +<ultralight/persistence.cpp>
lib_deps = 
    lovyan03/LovyanGFX@^1.2.7
    h2zero/NimBLE-Arduino@^1.4.0
    bblanchon/ArduinoJson@^7.0.0
    SPI
    SD
build_flags = 
    ${env.build_flags}
    -DULTRALIGHT_VARIANT
    -DULTRALIGHT_V2
    ; Note: CONFIG_LOG_* flags are already defined in SDK sdkconfig.h
    ; We set runtime log levels in main.cpp setup() instead to avoid redefinition warnings

; ============================================================
; FULLBLOWN: Mofa-Beacon
; ============================================================

[env:beacon]
board = esp32dev
build_src_filter = 
    +<beacon/>
lib_deps = 
    ${env.lib_deps}
    jgromes/RadioLib@^6.0.0
    h2zero/NimBLE-Arduino@^1.4.0
    adafruit/Adafruit MPU6050@^2.2.0
    adafruit/Adafruit Unified Sensor@^1.1.0
build_flags = 
    ${env.build_flags}
    -DBEACON_VARIANT
    -DLORA_ENABLED=1
    -DBLE_ENABLED=1
    -DIMU_ENABLED=1
    -DBEACON_ID=1  ; Override in config.h

; ============================================================
; FULLBLOWN: LoRa Gateway
; ============================================================

[env:gateway]
board = esp32dev
build_src_filter = 
    +<gateway/>
lib_deps = 
    ${env.lib_deps}
    jgromes/RadioLib@^6.0.0
    h2zero/NimBLE-Arduino@^1.4.0
    knolleary/PubSubClient@^2.8.0
build_flags = 
    ${env.build_flags}
    -DGATEWAY_VARIANT
    -DLORA_ENABLED=1
    -DBLE_ENABLED=1
    -DMQTT_ENABLED=1
    -DGATEWAY_ID=1  ; Override in config.h

; ============================================================
; FULLBLOWN: Smart Checkpoint (Optional)
; ============================================================

[env:checkpoint]
board = esp32dev
build_src_filter = 
    +<checkpoint/>
lib_deps = 
    ${env.lib_deps}
    jgromes/RadioLib@^6.0.0
    h2zero/NimBLE-Arduino@^1.4.0
build_flags = 
    ${env.build_flags}
    -DCHECKPOINT_VARIANT
    -DLORA_ENABLED=1
    -DBLE_ENABLED=1
    -DCHECKPOINT_ID=1  ; Override in config.h

; ============================================================
; FULLBLOWN: LED Display
; ============================================================

[env:display]
board = esp32dev
build_src_filter = 
    +<display/>
lib_deps = 
    ${env.lib_deps}
    jgromes/RadioLib@^6.0.0
    fastled/FastLED@^3.6.0
build_flags = 
    ${env.build_flags}
    -DDISPLAY_VARIANT
    -DLORA_ENABLED=1
    -DFASTLED_ENABLED=1
    -DDISPLAY_ID=1  ; Override in config.h
    -DNUM_LEDS=128  ; 8x8x2 panels

; ============================================================
; TEST ENVIRONMENTS
; ============================================================

[env:test]
platform = native
lib_deps = 
    ${env.lib_deps}
    throwtheswitch/Unity@^2.5.0
build_flags = 
    -DUNIT_TEST
    -std=gnu++11
test_build_src = true


